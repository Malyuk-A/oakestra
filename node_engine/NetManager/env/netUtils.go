package env

import (
	"log"
	"net"
)

// GetLocalIP returns the non loopback local IP of the host and the associated interface
func GetLocalIPandIface() (string, string) {
	list, err := net.Interfaces()
	if err != nil {
		panic(err)
	}

	for _, iface := range list {
		addrs, err := iface.Addrs()
		if err != nil {
			panic(err)
		}
		for _, address := range addrs {
			// check the address type and if it is not a loopback the display it
			if ipnet, ok := address.(*net.IPNet); ok && !ipnet.IP.IsLoopback() {
				if ipnet.IP.To4() != nil {
					log.Println("Local Interface in use: ", iface.Name, " with addr ", ipnet.IP.String())
					return ipnet.IP.String(), iface.Name
				}
			}
		}
	}

	return "", ""
}

func ToServiceIP(Type string, Addr string) ServiceIP {
	ip := ServiceIP{
		IpType:  0,
		Address: net.ParseIP(Addr),
	}

	if Type == "RR" {
		ip.IpType = RoundRobin
	}
	if Type == "Closest" {
		ip.IpType = Closest
	}
	if Type == "InstanceNumber" {
		ip.IpType = InstanceNumber
	}

	return ip
}
